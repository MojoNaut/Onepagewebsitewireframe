<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SVG Rubik â€“ Interior Reveal</title>

<style>
  body {
    margin: 0;
    background: #f5f1e8;
    display: grid;
    place-items: center;
    height: 100vh;
    font-family: system-ui, sans-serif;
  }

  svg {
    width: 520px;
    height: 520px;
  }

  .face.outer {
    stroke: rgba(0,0,0,0.18);
    stroke-width: 0.4;
    stroke-linejoin: round;
  }

  .face.interior {
    fill: #d0c9bc;
    stroke: rgba(0,0,0,0.25);
    stroke-width: 0.25;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
  }

  .cubie.rotating .face.interior {
    opacity: 1;
  }

  button {
    margin-top: 16px;
    padding: 8px 18px;
    border-radius: 999px;
    border: 1px solid #ccc;
    background: transparent;
    cursor: pointer;
  }
</style>
</head>

<body>

<div>
  <svg id="cube" viewBox="0 0 200 200"></svg>
  <div style="text-align:center">
    <button id="btn">Rotate Top</button>
  </div>
</div>

<script>
/* ======================================================
   BASIC SETUP
====================================================== */

const svg = document.getElementById("cube");
const SIZE = 18;
const GAP = 1.5;
const CENTER = 100;

const COLORS = {
  "+z": "#ede8dd",
  "-z": "#c4baa8",
  "+x": "#c4b5fd",
  "-x": "#d5c8b8",
  "+y": "#b8c4d0",
  "-y": "#d4cfc4"
};

/* ======================================================
   SVG HELPERS
====================================================== */

function polygon(points, cls, fill) {
  const p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
  p.setAttribute("points", points.map(p => p.join(",")).join(" "));
  p.setAttribute("class", cls);
  if (fill) p.setAttribute("fill", fill);
  return p;
}

function project(x, y, z) {
  const a = Math.PI / 4;
  const c = Math.cos(a), s = Math.sin(a);
  const px = (x * c - y * s) + CENTER;
  const py = (x * s + y * c - z) + CENTER;
  return [px, py];
}

/* ======================================================
   BUILD ONE CUBIE
====================================================== */

function buildCubie(ix, iy, iz) {
  const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
  g.classList.add("cubie");
  g.dataset.z = iz;

  const x = (ix - 1) * (SIZE + GAP);
  const y = (iy - 1) * (SIZE + GAP);
  const z = (iz - 1) * (SIZE + GAP);

  const s = SIZE / 2;

  const faces = [
    { id:"+z", n:[0,0,1],  pts:[[ -s,-s, s],[ s,-s, s],[ s, s, s],[ -s, s, s]] },
    { id:"-z", n:[0,0,-1], pts:[[ -s, s,-s],[ s, s,-s],[ s,-s,-s],[ -s,-s,-s]] },
    { id:"+x", n:[1,0,0],  pts:[[ s,-s,-s],[ s, s,-s],[ s, s, s],[ s,-s, s]] },
    { id:"-x", n:[-1,0,0], pts:[[ -s, s,-s],[ -s,-s,-s],[ -s,-s, s],[ -s, s, s]] },
    { id:"+y", n:[0,1,0],  pts:[[ s, s,-s],[ -s, s,-s],[ -s, s, s],[ s, s, s]] },
    { id:"-y", n:[0,-1,0], pts:[[ -s,-s,-s],[ s,-s,-s],[ s,-s, s],[ -s,-s, s]] }
  ];

  faces.forEach(f => {
    const outer =
      (f.id === "+z" && iz === 2) ||
      (f.id === "-z" && iz === 0) ||
      (f.id === "+x" && ix === 2) ||
      (f.id === "-x" && ix === 0) ||
      (f.id === "+y" && iy === 2) ||
      (f.id === "-y" && iy === 0);

    const pts = f.pts.map(p => project(p[0]+x, p[1]+y, p[2]+z));
    const cls = outer ? "face outer" : "face interior";
    const fill = outer ? COLORS[f.id] : null;

    g.appendChild(polygon(pts, cls, fill));
  });

  return g;
}

/* ======================================================
   BUILD FULL CUBE (ONCE)
====================================================== */

for (let x=0;x<3;x++)
  for (let y=0;y<3;y++)
    for (let z=0;z<3;z++)
      svg.appendChild(buildCubie(x,y,z));

/* ======================================================
   ANIMATION (TOP LAYER)
====================================================== */

let animating = false;

document.getElementById("btn").onclick = () => {
  if (animating) return;
  animating = true;

  const cubies = [...document.querySelectorAll(".cubie")]
    .filter(c => c.dataset.z === "2");

  cubies.forEach(c => c.classList.add("rotating"));

  const start = performance.now();
  const DURATION = 1200;

  function frame(t) {
    const p = Math.min((t - start) / DURATION, 1);
    const angle = p * 90;

    cubies.forEach(c => {
      c.setAttribute(
        "transform",
        `rotate(${angle} ${CENTER} ${CENTER})`
      );
    });

    if (p < 1) requestAnimationFrame(frame);
    else {
      cubies.forEach(c => {
        c.removeAttribute("transform");
        c.classList.remove("rotating");
      });
      animating = false;
    }
  }

  requestAnimationFrame(frame);
};
</script>

</body>
</html>
